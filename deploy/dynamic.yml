http:
  routers:
    ping:
      entryPoints:
      - http
      rule: Path(`/ping`)
      middlewares:
      - my-auth
      service: ping@internal
    ping-https:
      entryPoints:
      - https
      rule: Host(`dev.gs.nethserver.net`) && Path(`/ping`)
      middlewares:
      - my-auth
      service: ping@internal
    register-nethesis:
      entryPoints:
        - http
      middlewares:
        - strip-brand
      rule: PathPrefix(`/nethesis/register`)
      service: fpp-nethesis
    register-nethesis-https:
      entryPoints:
        - https
      middlewares:
        - strip-brand
      rule: PathPrefix(`/nethesis/register`)
      service: fpp-nethesis
    send-push-nethesis:
      entryPoints:
        - http
      middlewares:
        - my-auth
        - remove-auth-header
        - strip-brand
      rule: PathPrefix(`/nethesis/`)
      service: fpp-nethesis
    send-push-https-nethesis:
      entryPoints:
        - https
      middlewares:
        - my-auth
        - remove-auth-header
        - strip-brand
      rule: PathPrefix(`/nethesis/`)
      service: fpp-nethesis
  middlewares:
    my-auth:
      forwardAuth:
        address: 'https://my.nethesis.it/auth'
    remove-auth-header:
      headers:
        customRequestHeaders:
          Authorization: ''
    strip-brand:
      stripPrefix:
        prefixes:
          - "/nethesis"
  services:
    fpp-nethesis:
      loadBalancer:
        passHostHeader: false
        servers:
          - url: 'http://localhost:9191'

